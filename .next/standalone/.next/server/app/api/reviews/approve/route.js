"use strict";(()=>{var e={};e.id=838,e.ids=[838],e.modules={399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},8605:(e,t,a)=>{a.r(t),a.d(t,{originalPathname:()=>c,patchFetch:()=>w,requestAsyncStorage:()=>m,routeModule:()=>u,serverHooks:()=>g,staticGenerationAsyncStorage:()=>v});var i={};a.r(i),a.d(i,{POST:()=>d});var o=a(9303),n=a(8716),r=a(670),s=a(7070),p=a(6543),l=a(5074);async function d(e){try{let t=await e.json(),{reviewId:a,approved:i}=l.y$.parse(t),o=new p.Y;return await o.approveReview(a,i,"admin"),s.NextResponse.json({status:"success",data:{reviewId:a,approved:i}})}catch(e){if(console.error("Error approving review:",e),e instanceof Error&&e.message.includes("Review not found"))return s.NextResponse.json({status:"error",error:"Review not found"},{status:404});return s.NextResponse.json({status:"error",error:"Failed to approve review",message:e instanceof Error?e.message:"Unknown error"},{status:500})}}let u=new o.AppRouteRouteModule({definition:{kind:n.x.APP_ROUTE,page:"/api/reviews/approve/route",pathname:"/api/reviews/approve",filename:"route",bundlePath:"app/api/reviews/approve/route"},resolvedPagePath:"/home/achref/Downloads/achref/app/api/reviews/approve/route.ts",nextConfigOutput:"standalone",userland:i}),{requestAsyncStorage:m,staticGenerationAsyncStorage:v,serverHooks:g}=u,c="/api/reviews/approve/route";function w(){return(0,r.patchFetch)({serverHooks:g,staticGenerationAsyncStorage:v})}},2663:(e,t,a)=>{a.d(t,{_:()=>o});let i=require("@prisma/client"),o=globalThis.prisma??new i.PrismaClient},5074:(e,t,a)=>{a.d(t,{Kb:()=>o,PQ:()=>r,y$:()=>n});var i=a(1067);let o=i.Ry({listingId:i.Z_().optional(),type:i.Z_().optional(),status:i.Z_().optional(),channel:i.Z_().optional(),minRating:i.oQ.number().min(0).max(10).optional(),maxRating:i.oQ.number().min(0).max(10).optional(),from:i.Z_().optional(),to:i.Z_().optional(),approved:i.oQ.boolean().optional(),q:i.Z_().optional(),page:i.oQ.number().min(1).default(1),pageSize:i.oQ.number().min(1).max(100).default(20),sort:i.Z_().optional()}),n=i.Ry({reviewId:i.Z_().cuid(),approved:i.O7()}),r=i.Ry({listingId:i.Z_().optional(),from:i.Z_().optional(),to:i.Z_().optional(),bucket:i.Km(["day","week","month"]).default("month")});i.Ry({id:i.Z_(),type:i.Z_(),status:i.Z_(),rating:i.Rx().optional(),publicReview:i.Z_().optional(),reviewCategory:i.IX(i.Ry({category:i.Z_(),rating:i.Rx()})).optional(),submittedAt:i.Z_(),guestName:i.Z_().optional(),listingName:i.Z_(),channel:i.Z_().optional()}),i.Ry({id:i.Z_(),source:i.Km(["hostaway","google"]),externalId:i.Z_().optional(),listing:i.Ry({id:i.Z_(),name:i.Z_()}),type:i.Km(["host-to-guest","guest-to-host"]),status:i.Km(["published","draft","hidden"]),ratingOverall:i.Rx().nullable().optional(),categories:i.IM(i.Rx()).optional(),text:i.Z_().optional(),authorName:i.Z_().optional(),channel:i.Z_().optional(),submittedAt:i.Z_(),approved:i.O7()})},6543:(e,t,a)=>{a.d(t,{Y:()=>n});var i=a(2663),o=a(5074);class n{async getReviews(e){let t=o.Kb.parse(e),a={};t.listingId&&(a.listingId=t.listingId),t.type&&(a.type=t.type),t.status&&(a.status=t.status),t.channel&&(a.channel=t.channel),void 0!==t.approved&&(a.approved=t.approved),(t.minRating||t.maxRating)&&(a.ratingOverall={},t.minRating&&(a.ratingOverall.gte=t.minRating),t.maxRating&&(a.ratingOverall.lte=t.maxRating)),(t.from||t.to)&&(a.submittedAt={},t.from&&(a.submittedAt.gte=new Date(t.from)),t.to&&(a.submittedAt.lte=new Date(t.to))),t.q&&(a.OR=[{text:{contains:t.q,mode:"insensitive"}},{authorName:{contains:t.q,mode:"insensitive"}}]);let n={submittedAt:"desc"};if(t.sort){let[e,a]=t.sort.split(":");n={[e]:a||"desc"}}let r=t.page||1,s=t.pageSize||20,[p,l]=await Promise.all([i._.review.findMany({where:a,include:{listing:!0},orderBy:n,skip:(r-1)*s,take:s}),i._.review.count({where:a})]);return{items:p.map(e=>({id:e.id,source:e.source,externalId:e.externalId||void 0,listing:{id:e.listing.id,name:e.listing.name},type:e.type,status:e.status,ratingOverall:e.ratingOverall,categories:e.categories,text:e.text||void 0,authorName:e.authorName||void 0,channel:e.channel||void 0,submittedAt:e.submittedAt.toISOString(),approved:e.approved})),page:r,pageSize:s,total:l}}async approveReview(e,t,a){if(!await i._.review.findUnique({where:{id:e}}))throw Error("Review not found");await i._.$transaction([i._.review.update({where:{id:e},data:{approved:t}}),i._.reviewSelectionLog.create({data:{reviewId:e,action:t?"approved":"unapproved",actor:a}})])}async getPublicReviews(e){let t=await i._.listing.findUnique({where:{id:e}});if(!t)throw Error("Listing not found");let a=(await i._.review.findMany({where:{listingId:e,approved:!0},include:{listing:!0},orderBy:{submittedAt:"desc"}})).map(e=>({id:e.id,source:e.source,externalId:e.externalId||void 0,listing:{id:e.listing.id,name:e.listing.name},type:e.type,status:e.status,ratingOverall:e.ratingOverall,categories:e.categories,text:e.text||void 0,authorName:e.authorName||void 0,channel:e.channel||void 0,submittedAt:e.submittedAt.toISOString(),approved:e.approved}));return{listing:{id:t.id,name:t.name},items:a}}}}};var t=require("../../../../webpack-runtime.js");t.C(e);var a=e=>t(t.s=e),i=t.X(0,[276,934],()=>a(8605));module.exports=i})();